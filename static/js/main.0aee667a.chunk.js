(window.webpackJsonptychess=window.webpackJsonptychess||[]).push([[0],{42:function(e,t,n){e.exports=n(68)},48:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var r,a=n(1),i=n.n(a),o=n(23),l=n.n(o),c=(n(47),n(14)),u=n(70),s=n(71),h=n(72),f=n(73),d=n(74),v=n(75),k=n(76),g=n(77),m=(n(48),function(){var e=Object(a.useState)(!1),t=Object(c.a)(e,2),n=t[0],r=t[1];return i.a.createElement(u.a,{color:"dark",dark:!0,expand:"xs"},i.a.createElement(s.a,null,i.a.createElement(h.a,{href:".",color:"dark"},"tychess"),i.a.createElement(f.a,{onClick:function(){return r(!n)},className:"mr-2"}),i.a.createElement(d.a,{isOpen:n,navbar:!0},i.a.createElement(v.a,{navbar:!0},i.a.createElement(k.a,null,i.a.createElement(g.a,{href:"https://github.com/tpamula/tychess",target:"_blank"},"source code"))))))}),y=function(e){return i.a.createElement("div",{id:"main-wrapper"},i.a.createElement(m,null),i.a.createElement(s.a,null,e.children))},b=n(78),w=n(79),p=n(82),P=n(86),C=n(83),S=n(84),O=n(85),M=n(80),E=n(13),j=n.n(E),B=n(19),A=n(20),W=n(3),K=n(4),_=n(11),R=n(9),N=n(10),q=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,[{key:"referentialEquals",value:function(e){if(null===e)return!1;for(var t=0,n=Object.keys(this);t<n.length;t++){var r=n[t];if(this[r]!==e[r])return!1}return!0}}]),e}();!function(e){e.white="white",e.black="black"}(r||(r={}));var D=r,I=function(e){function t(e){var n;return Object(W.a)(this,t),(n=Object(_.a)(this,Object(R.a)(t).call(this))).algebraicNotation=void 0,n.color=void 0,n.unicodeSymbol=void 0,n.algebraicNotation=e,n.color=e.toUpperCase()===e?D.white:D.black,n.unicodeSymbol=n.getUnicodeSymbol(e),n}return Object(N.a)(t,e),Object(K.a)(t,[{key:"getUnicodeSymbol",value:function(e){switch(e){case"P":return"\u2659";case"R":return"\u2656";case"N":return"\u2658";case"B":return"\u2657";case"Q":return"\u2655";case"K":return"\u2654";case"p":return"\u265f";case"r":return"\u265c";case"n":return"\u265e";case"b":return"\u265d";case"q":return"\u265b";case"k":return"\u265a"}}}],[{key:"fromAlgebraicNotation",value:function(e){switch(e){case"P":return t.WhitePawn;case"R":return t.WhiteRook;case"N":return t.WhiteKnight;case"B":return t.WhiteBishop;case"Q":return t.WhiteQueen;case"K":return t.WhiteKing;case"p":return t.BlackPawn;case"r":return t.BlackRook;case"n":return t.BlackKnight;case"b":return t.BlackBishop;case"q":return t.BlackQueen;case"k":return t.BlackKing}}}]),t}(q);I.BlackBishop=new I("b"),I.BlackKing=new I("k"),I.BlackKnight=new I("n"),I.BlackPawn=new I("p"),I.BlackQueen=new I("q"),I.BlackRook=new I("r"),I.WhiteBishop=new I("B"),I.WhiteKing=new I("K"),I.WhiteKnight=new I("N"),I.WhitePawn=new I("P"),I.WhiteQueen=new I("Q"),I.WhiteRook=new I("R");var F,T=n(41),V=function(e){function t(){return Object(W.a)(this,t),Object(_.a)(this,Object(R.a)(t).apply(this,arguments))}return Object(N.a)(t,e),t}(Object(T.a)(Error)),x=[1,2,3,4,5,6,7,8],Q=function(e){return x.map((function(e){return e.toString()})).includes(e.toString())},U=["a","b","c","d","e","f","g","h"],H=function(e){return U.map((function(e){return e.toString()})).includes(e)},G=function(e){function t(e,n){var r;return Object(W.a)(this,t),(r=Object(_.a)(this,Object(R.a)(t).call(this))).file=void 0,r.rank=void 0,r.file=e,r.rank=n,r}return Object(N.a)(t,e),Object(K.a)(t,[{key:"toAlgebraicNotationString",value:function(){return"".concat(this.file).concat(this.rank)}}],[{key:"fromAlgebraicNotation",value:function(e){var n=e[0],r=parseInt(e[1],10);if(!H(n)||!Q(r))throw new V("Invalid from file/rank - file: ".concat(n," rank: ").concat(r,"."));return new t(n,r)}}]),t}(q),L=function(e){function t(e,n){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(W.a)(this,t),(r=Object(_.a)(this,Object(R.a)(t).call(this))).from=e,r.to=n,r.promoteTo=a,r}return Object(N.a)(t,e),Object(K.a)(t,[{key:"getTraversalCoordinatesBetweenFromTo",value:function(){var e=[];if(!this.isDiagonal&&!this.isHorizontalOrVertical)return e;for(var t=this.fileDirection,n=this.rankDirection;t!==this.fileDelta||n!==this.rankDelta;t+=this.fileDirection,n+=this.rankDirection){var r=U.indexOf(this.from.file)+t,a=x.indexOf(this.from.rank)+n,i=new G(U[r],x[a]);e.push(i)}return e.push(this.to),e}},{key:"isTraversable",value:function(){return this.isDiagonal||this.isHorizontalOrVertical}},{key:"toUciString",value:function(){return"".concat(this.from.file).concat(this.from.rank).concat(this.to.file).concat(this.to.rank).concat(this.promoteTo||"")}},{key:"fileDelta",get:function(){return U.indexOf(this.to.file)-U.indexOf(this.from.file)}},{key:"fileDirection",get:function(){return Math.sign(this.fileDelta)}},{key:"hasPromotion",get:function(){return null!==this.promoteTo}},{key:"isDiagonal",get:function(){return Math.abs(this.rankDelta)===Math.abs(this.fileDelta)&&0!==this.rankDelta}},{key:"isHorizontalOrVertical",get:function(){return 0!==this.rankDirection&&0===this.fileDirection||0===this.rankDirection&&0!==this.fileDirection}},{key:"rankDelta",get:function(){return this.to.rank-this.from.rank}},{key:"rankDirection",get:function(){return Math.sign(this.rankDelta)}}],[{key:"fromUciString",value:function(e){return new t(G.fromAlgebraicNotation(e.substring(0,2)),G.fromAlgebraicNotation(e.substring(2,4)),5===e.length?I.fromAlgebraicNotation(e[4]):null)}}]),t}(q),z=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,null,[{key:"canTraverse",value:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;return t.isTraversable()&&!e.traversalStepsExceeded(t,a)&&e.hasNoUncapturablePiecesOnPath(t,n,r,a)}},{key:"hasNoUncapturablePiecesOnPath",value:function(t,n,r,a){var i=!0,o=!1,l=void 0;try{for(var c,u=t.getTraversalCoordinatesBetweenFromTo()[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var s=c.value;if(a--<=0)return!0;var h=n.isPieceOnSquare(s);if(e.isFinalSquare(s,t.to)&&(!h||r&&e.isCaptureValid(t,n)))return!0;if(h)return!1}}catch(f){o=!0,l=f}finally{try{i||null==u.return||u.return()}finally{if(o)throw l}}return!0}},{key:"isCaptureValid",value:function(e,t){return t.getPiece(e.from).color!==t.getPiece(e.to).color}},{key:"isFinalSquare",value:function(e,t){return e.referentialEquals(t)}},{key:"traversalStepsExceeded",value:function(e,t){return Math.abs(e.fileDelta)>t||Math.abs(e.rankDelta)>t}}]),e}(),J=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,null,[{key:"add",value:function(e,t,n){if(!this.canAdd(e,t,n))throw new V("Invalid operation - element: ".concat(e.toAlgebraicNotationString(),", fileDelta: ").concat(t,", rankDelta: ").concat(n,"."));return new G(this.addFile(e.file,t),this.addRank(e.rank,n))}},{key:"canAdd",value:function(t,n,r){return e.canAddFile(t.file,n)&&e.canAddRank(t.rank,r)}},{key:"tryAdd",value:function(e,t,n){return this.canAdd(e,t,n)?this.add(e,t,n):null}},{key:"addFile",value:function(e,t){if(!this.canAddFile(e,t))throw new V("Invalid operation - file: ".concat(e,", delta: ").concat(t,"."));return U[U.indexOf(e)+t]}},{key:"addRank",value:function(e,t){if(!this.canAddRank(e,t))throw new V("Invalid operation - rank: ".concat(e,", delta: ").concat(t,"."));return e+t}},{key:"canAddFile",value:function(e,t){var n=U.indexOf(e)+t;return Array.from(U.keys()).includes(n)}},{key:"canAddRank",value:function(e,t){return x.map((function(e){return e})).includes(e+t)}}]),e}(),Y=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,[{key:"isMoveValid",value:function(e,t){return this.doesMoveForward(e,t)&&this.hasValidPromotionOnlyIfLandingOnEndRow(e,t)&&this.landsOnSquareWithEmptyOrOppositePiece(e,t)&&(this.isValidForwardMove(e,t)||this.isValidAttackingMove(e,t)||this.isValidEnPassantMove(e,t))}},{key:"doesMoveForward",value:function(e,t){var n=t.board.getPiece(e.from);if(null===n)throw new V("Piece is null.");return n.color===D.white&&e.rankDelta>0||n.color===D.black&&e.rankDelta<0}},{key:"getAttackingCoordinates",value:function(e,t,n){var r=t===D.white?1:-1;return J.tryAdd(e,n,r)}},{key:"hasValidPromotionOnlyIfLandingOnEndRow",value:function(e,t){var n=t.board.getPiece(e.from);if(null===n)throw new V("Piece is null");return n.color===D.white&&8===e.to.rank||n.color===D.black&&1===e.to.rank?null!==e.promoteTo&&(![I.WhiteKing,I.WhitePawn,I.BlackKing,I.BlackPawn].includes(e.promoteTo)&&n.color===e.promoteTo.color):!e.hasPromotion}},{key:"isValidAttackingMove",value:function(e,t){var n=this,r=t.board.getPiece(e.from);if(null===r)throw new V("Piece is null");var a=r.color===D.white?-1:1,i=-a,o=function(a){var i=n.getAttackingCoordinates(e.from,r.color,a);if(null===i)return!1;var o=t.board.getPiece(i),l=null!=o&&o.color!==r.color;return e.to.referentialEquals(i)&&l};return o(a)||o(i)}},{key:"isValidEnPassantMove",value:function(e,t){var n=t.board.getPiece(e.from);if(null===n)throw new V("Piece is null");var r=this.getAttackingCoordinates(e.from,n.color,-1),a=this.getAttackingCoordinates(e.from,n.color,1);return(e.to.referentialEquals(r)||e.to.referentialEquals(a))&&e.to.referentialEquals(t.enPassant)}},{key:"isValidForwardMove",value:function(e,t){if(e.to.file!==e.from.file)return!1;var n=t.board.getPiece(e.from);if(null===n)throw new V("Piece is null");var r=n.color===D.white&&2===e.from.rank||n.color===D.black&&7===e.from.rank?2:1;return z.canTraverse(e,t.board,!1,r)}},{key:"landsOnSquareWithEmptyOrOppositePiece",value:function(e,t){var n=t.board.getPiece(e.from);if(null===n)throw new V("Piece is null");var r=t.board.getPiece(e.to);return null===r||n.color!==r.color}}]),e}(),$=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,[{key:"isMoveValid",value:function(e,t){return!e.hasPromotion&&e.isDiagonal&&z.canTraverse(e,t.board,!0)}}]),e}(),X=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,[{key:"isMoveValid",value:function(e,t){return!e.hasPromotion&&e.isHorizontalOrVertical&&z.canTraverse(e,t.board,!0)}}]),e}(),Z=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,[{key:"isMoveValid",value:function(e,t){return(new X).isMoveValid(e,t)||(new $).isMoveValid(e,t)}}]),e}();!function(e){e.whiteKingside="K",e.whiteQueenside="Q",e.blackKingside="k",e.blackQueenside="q"}(F||(F={}));var ee,te=F,ne=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,null,[{key:"castlingToMoves",value:function(e){switch(e){case F.whiteKingside:return[L.fromUciString("e1g1"),L.fromUciString("h1f1")];case F.whiteQueenside:return[L.fromUciString("e1c1"),L.fromUciString("a1d1")];case F.blackKingside:return[L.fromUciString("e8g8"),L.fromUciString("h8f8")];case F.blackQueenside:return[L.fromUciString("e8c8"),L.fromUciString("a8d8")]}}},{key:"getCastlingColor",value:function(e){switch(e){case F.whiteKingside:case F.whiteQueenside:return D.white;case F.blackKingside:case F.blackQueenside:return D.black;default:throw new V("Invalid castling.")}}},{key:"getCastlingKingCoordinates",value:function(e){var t;switch(e){case F.whiteKingside:case F.whiteQueenside:t=G.fromAlgebraicNotation("e1");break;case F.blackKingside:case F.blackQueenside:t=G.fromAlgebraicNotation("e8");break;default:throw new V("Invalid castling.")}return t}},{key:"getCastlingRookCoordinates",value:function(e){var t;switch(e){case F.whiteKingside:t=G.fromAlgebraicNotation("h1");break;case F.whiteQueenside:t=G.fromAlgebraicNotation("a1");break;case F.blackKingside:t=G.fromAlgebraicNotation("h8");break;case F.blackQueenside:t=G.fromAlgebraicNotation("a8");break;default:throw new V("Invalid castling.")}return t}},{key:"isCastling",value:function(t,n){switch(e.kingMoveToCastling(n)){case F.whiteKingside:case F.whiteQueenside:return t===I.WhiteKing;case F.blackKingside:case F.blackQueenside:return t===I.BlackKing;default:return!1}}},{key:"kingMoveToCastling",value:function(e){switch(e.toUciString()){case"e1g1":return F.whiteKingside;case"e1c1":return F.whiteQueenside;case"e8g8":return F.blackKingside;case"e8c8":return F.blackQueenside;default:return null}}}]),e}(),re=function(){function e(){Object(W.a)(this,e),this._kingCastlingRules=new ae}return Object(K.a)(e,[{key:"isMoveValid",value:function(e,t){return!e.hasPromotion&&(this._kingCastlingRules.isValidCastling(e,t)||!this.movesByMoreThanOneField(e)&&(new Z).isMoveValid(e,t))}},{key:"movesByMoreThanOneField",value:function(e){return Math.abs(e.fileDelta)>1||Math.abs(e.rankDelta)>1}}]),e}(),ae=function(){function e(){Object(W.a)(this,e),this._chessRules=new se}return Object(K.a)(e,[{key:"isValidCastling",value:function(e,t){var n=ne.kingMoveToCastling(e);return null!==n&&(t.castlings.includes(n)&&!this.isPieceBetweenKingAndRook(n,t)&&!this.kingMovesThroughAttackedField(n,e,t))}},{key:"getCoordinatesBetweenKingAndRook",value:function(e){var t,n=[],r=ne.getCastlingKingCoordinates(e);switch(e){case te.whiteKingside:case te.blackKingside:t=3;break;case te.whiteQueenside:case te.blackQueenside:t=-4;break;default:throw new V("Invalid castling.")}for(var a=Math.sign(t);Math.abs(a)<Math.abs(t);a+=Math.sign(t))n.push(J.add(r,a,0));return n}},{key:"isPieceBetweenKingAndRook",value:function(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=this.getCoordinatesBetweenKingAndRook(e)[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var l=i.value;if(null!==t.board.getPiece(l))return!0}}catch(c){r=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return!1}},{key:"kingMovesThroughAttackedField",value:function(e,t,n){if(this._chessRules.isSquareAttacked(t.from,n,ne.getCastlingColor(e)===D.white?D.black:D.white))return!0;var r=!0,a=!1,i=void 0;try{for(var o,l=this.getCoordinatesBetweenKingAndRook(e)[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var c=o.value;if(this._chessRules.isSquareAttacked(c,n,ne.getCastlingColor(e)===D.white?D.black:D.white))return!0}}catch(u){a=!0,i=u}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}return!1}}]),e}(),ie=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,[{key:"isMoveValid",value:function(e,t){var n=this;return!e.hasPromotion&&this.getPossibleLandingCoordinates(e.from).some((function(r){return e.to.referentialEquals(r)&&n.landsOnEmptyOrOppositeColor(e,t)}))}},{key:"getPossibleLandingCoordinates",value:function(e){for(var t=[],n=[-1,1],r=0,a=n;r<a.length;r++){var i=a[r],o=!0,l=!1,c=void 0;try{for(var u,s=n[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var h=u.value,f=J.tryAdd(e,h,2*i);null!==f&&t.push(f),null!==(f=J.tryAdd(e,2*h,i))&&t.push(f)}}catch(d){l=!0,c=d}finally{try{o||null==s.return||s.return()}finally{if(l)throw c}}}return t}},{key:"landsOnEmptyOrOppositeColor",value:function(e,t){var n=t.board.getPiece(e.from);if(null===n)throw new V("Knight is null.");var r=t.board.getPiece(e.to);return null===r||r.color!==n.color}}]),e}(),oe=function(e){function t(){var e;return Object(W.a)(this,t),(e=Object(_.a)(this,Object(R.a)(t).call(this)))._internalState=Object(A.a)(Array(8)).map((function(){return Array(8).fill(null)})),e.isPieceOnSquare=function(t){return null!==e.getPiece(t)},e}return Object(N.a)(t,e),Object(K.a)(t,[{key:"findPieceCoordinates",value:function(e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,l=t.allCoordinates[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var c=o.value;this.getPiece(c)===e&&n.push(c)}}catch(u){a=!0,i=u}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}return n}},{key:"getPiece",value:function(e){var n=t.rankToRow(e.rank),r=t.fileToColumn(e.file);return this._internalState[n][r]}},{key:"toFen",value:function(){for(var e="",t=0,n=function(){0!==t&&(e+=t,t=0)},r=x.length-1;r>=0;r--){for(var a=0;a<U.length;a++){var i=this.getPiece(new G(U[a],x[r]));null===i?t++:(n(),e+=i.algebraicNotation)}n(),0!==r&&(e+="/")}return e}},{key:"withMove",value:function(e){var t=this.getPiece(e.from);return this.withPiece(e.from,null).withPiece(e.to,t)}},{key:"withPiece",value:function(e,n){var r=t.rankToRow(e.rank),a=t.fileToColumn(e.file),i=this.clone();return i._internalState[r][a]=n,i}},{key:"clone",value:function(){var e=new t;return e._internalState=JSON.parse(JSON.stringify(this._internalState)),e}}],[{key:"fromFen",value:function(e){for(var n=new t,r=0,a=x.length-1,i=e.split(" ")[0],o=0;o<i.length;o++)if("/"!==e[o]){var l=parseInt(e[o],10);if(isNaN(l)){var c=t.rankToRow(x[a]),u=t.fileToColumn(U[r]);n._internalState[c][u]=I.fromAlgebraicNotation(e[o]),r++}else r+=l}else a--,r=0;return n}},{key:"fileToColumn",value:function(e){return e.charCodeAt(0)-"a".charCodeAt(0)}},{key:"getAllCoordinates",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var a,i=U[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,l=!0,c=!1,u=void 0;try{for(var s,h=x[Symbol.iterator]();!(l=(s=h.next()).done);l=!0){var f=s.value,d=new G(o,f);e.push(d)}}catch(v){c=!0,u=v}finally{try{l||null==h.return||h.return()}finally{if(c)throw u}}}}catch(v){n=!0,r=v}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}},{key:"rankToRow",value:function(e){return e-1}}]),t}(q);oe.allCoordinates=oe.getAllCoordinates(),function(e){e.ongoing="ongoing",e.ongoingWhiteKingInCheck="ongoing, white king in check",e.ongoingBlackKingInCheck="ongoing, black king in check",e.checkmateWhiteWon="checkmate, white won",e.checkmateBlackWon="checkmate, black won",e.drawStalemate="draw, stalemate",e.drawThreefoldRepetition="draw, threefold repetition",e.draw50MoveRule="draw, 50 move rule"}(ee||(ee={}));var le,ce=[ee.ongoing,ee.ongoingWhiteKingInCheck,ee.ongoingBlackKingInCheck],ue=ee,se=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,[{key:"getGameStatus",value:function(e){if(0===e.length)throw new V("Empty game history");var t=e[e.length-1];return this.isCheckmate(t)?t.currentColor===D.white?ue.checkmateBlackWon:ue.checkmateWhiteWon:this.isStalemate(t)?ue.drawStalemate:this.isDraw50MoveRule(t)?ue.draw50MoveRule:this.isDrawThreefoldRepetition(e)?ue.drawThreefoldRepetition:this.isKingInCheck(t)?t.currentColor===D.white?ue.ongoingWhiteKingInCheck:ue.ongoingBlackKingInCheck:ue.ongoing}},{key:"isMoveValid",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.board.getPiece(e.from);if(null===r)return!1;var a=this.getPieceRules(r);return a.isMoveValid(e,t)&&(!n||!this.isKingInCheckAfterMove(e,t))}},{key:"isSquareAttacked",value:function(e,t,n){var r=!0,a=!1,i=void 0;try{for(var o,l=oe.allCoordinates[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var c=o.value,u=t.board.getPiece(c);if((!u||u.color===n)&&null!==u){var s=new L(c,e),h=u.color===D.white?I.WhiteQueen:I.BlackQueen,f=new L(c,e,h);if(this.isMoveValid(s,t,!1)||this.isMoveValid(f,t,!1))return!0}}}catch(d){a=!0,i=d}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}return!1}},{key:"getPieceRules",value:function(e){switch(e){case I.WhitePawn:case I.BlackPawn:return new Y;case I.WhiteBishop:case I.BlackBishop:return new $;case I.WhiteRook:case I.BlackRook:return new X;case I.WhiteQueen:case I.BlackQueen:return new Z;case I.WhiteKing:case I.BlackKing:return new re;case I.WhiteKnight:case I.BlackKnight:return new ie;default:throw new V("Invalid piece.")}}},{key:"canMoveAnyPiece",value:function(e){var t=this,n=function(n){var r=!0,a=!1,i=void 0;try{for(var o,l=oe.allCoordinates[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var c=o.value;if(t.isMoveValid(new L(n,c),e))return!0}}catch(u){a=!0,i=u}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}return!1},r=!0,a=!1,i=void 0;try{for(var o,l=oe.allCoordinates[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var c=o.value,u=e.board.getPiece(c);if(null!==u&&u.color===e.currentColor&&n(c))return!0}}catch(s){a=!0,i=s}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}return!1}},{key:"isCheckmate",value:function(e){return this.isKingInCheck(e)&&!this.canMoveAnyPiece(e)}},{key:"isDraw50MoveRule",value:function(e){return 100===e.halfMoveClock}},{key:"isDrawThreefoldRepetition",value:function(e){var t=e.reduce((function(e,t){return e.set(t.board.toFen(),(e.get(t.board.toFen())||0)+1)}),new Map);return Array.from(t.values()).includes(3)}},{key:"isKingInCheck",value:function(e){var t=e.board.findPieceCoordinates(e.currentColor===D.white?I.WhiteKing:I.BlackKing)[0],n=e.currentColor===D.white?D.black:D.white;return!!this.isSquareAttacked(t,e,n)}},{key:"isKingInCheckAfterMove",value:function(e,t){var n=t.withBoard(t.board.withMove(e));return this.isKingInCheck(n)}},{key:"isStalemate",value:function(e){return!this.isKingInCheck(e)&&!this.canMoveAnyPiece(e)}}]),e}(),he=function(e){function t(){return Object(W.a)(this,t),Object(_.a)(this,Object(R.a)(t).apply(this,arguments))}return Object(N.a)(t,e),t}(q),fe=function(){function e(){Object(W.a)(this,e),this._resolveGetMovePromise=null}return Object(K.a)(e,[{key:"getMove",value:function(){var e=Object(B.a)(j.a.mark((function e(t){var n=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n._resolveGetMovePromise=e})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"makeMove",value:function(e){null!==this._resolveGetMovePromise&&(this._resolveGetMovePromise(e),this._resolveGetMovePromise=null)}},{key:"requestUndo",value:function(){null!==this._resolveGetMovePromise&&(this._resolveGetMovePromise(new he),this._resolveGetMovePromise=null)}}]),e}(),de=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new se;Object(W.a)(this,e),this.playerWhite=n,this.playerBlack=r,this.ruleEngine=a,this._gameStateHistory=[],this._moveProcessedSubscribers=[],this._gameStateHistory.push(t),this.startGame()}return Object(K.a)(e,[{key:"getCurrentPlayer",value:function(){return this.getCurrentState().currentColor===D.white?this.playerWhite:this.playerBlack}},{key:"getCurrentState",value:function(){return this._gameStateHistory[this._gameStateHistory.length-1]}},{key:"getCurrentStatus",value:function(){return this.ruleEngine.getGameStatus(this._gameStateHistory)}},{key:"subscribeMoveProcessed",value:function(e){this._moveProcessedSubscribers.push(e)}},{key:"awaitUndoRequestedAfterGameFinished",value:function(){var e=this,t=function t(n,r){return n.getMove(e.getCurrentState()).then((function(e){e instanceof he?r():t(n,r)}))};return new Promise((function(n){e.playerWhite instanceof fe&&t(e.playerWhite,n),e.playerBlack instanceof fe&&t(e.playerBlack,n)}))}},{key:"makeMoveIfValid",value:function(e){var t=this;!function(){var n=t.getCurrentState().board.getPiece(e.from);if(null!==n&&!(n.color!==t.getCurrentState().currentColor))if(t.ruleEngine.isMoveValid(e,t.getCurrentState())){var r=t.getCurrentState().afterMove(e);t._gameStateHistory=[].concat(Object(A.a)(t._gameStateHistory),[r])}else if(!(t.getCurrentPlayer()instanceof fe))throw new V("Non-human player made an invalid move: ".concat(e.toUciString(),"."))}(),this.notifyMoveProcessed()}},{key:"notifyMoveProcessed",value:function(){this._moveProcessedSubscribers.forEach((function(e){return e()}))}},{key:"startGame",value:function(){var e=Object(B.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ce.includes(this.getCurrentStatus())){e.next=8;break}return e.next=4,this.getCurrentPlayer().getMove(this.getCurrentState());case 4:(t=e.sent)instanceof he?this.undoFullMove():this.makeMoveIfValid(t),e.next=11;break;case 8:return e.next=10,this.awaitUndoRequestedAfterGameFinished();case 10:this.undoFullMove();case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"undoFullMove",value:function(){var e=this;!function(){if(!(e._gameStateHistory.length<=1)){var t=e._gameStateHistory.length<=2?1:2;e._gameStateHistory=e._gameStateHistory.slice(0,e._gameStateHistory.length-t)}}(),this.notifyMoveProcessed()}}]),e}(),ve=function(e){function t(e){var n;return Object(W.a)(this,t),(n=Object(_.a)(this,Object(R.a)(t).call(this)))._fen=void 0,n._board=void 0,n._fen=e,n}return Object(N.a)(t,e),Object(K.a)(t,[{key:"afterMove",value:function(e){var n=this.getBoardAfterMove(e),r=this.getColorAfterMove(),a=this.getCastlings(e),i=this.getEnPassantStateAfterMove(e),o=this.getHalfMoveClockAfterMove(e),l=this.getFullMoveNumberAfterMove();return t.fromParts(n,r,a,i,o,l)}},{key:"withBoard",value:function(e){return t.fromParts(e,this.currentColor,this.castlings,this.enPassant,this.halfMoveClock,this.fullMoveNumber)}},{key:"getBoardAfterMove",value:function(e){var t=this.board,n=this.board.getPiece(e.from);if(null===n)throw new V("Move from is null");if(ne.isCastling(n,e)){var r=ne.castlingToMoves(ne.kingMoveToCastling(e)),a=!0,i=!1,o=void 0;try{for(var l,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value,s=this.board.getPiece(u.from);t=t.withPiece(u.from,null).withPiece(u.to,s)}}catch(d){i=!0,o=d}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}}else{var h=e.promoteTo||n;if(t=t.withPiece(e.from,null).withPiece(e.to,h),null!==this.enPassant&&e.to.referentialEquals(this.enPassant)){var f=3===this.enPassant.rank?4:5;t=t.withPiece(new G(this.enPassant.file,f),null)}}return t}},{key:"getCastlings",value:function(e){var t=this,n=[],r=function(t){var n=ne.getCastlingRookCoordinates(t);return e.from.referentialEquals(n)},a=function(e){switch(e){case te.whiteKingside:case te.whiteQueenside:return t.board.findPieceCoordinates(I.WhiteKing)[0].referentialEquals(G.fromAlgebraicNotation("e1"));case te.blackKingside:case te.blackQueenside:return t.board.findPieceCoordinates(I.BlackKing)[0].referentialEquals(G.fromAlgebraicNotation("e8"));default:throw new V("Invalid castling.")}},i=function(e){var n=ne.getCastlingRookCoordinates(e);return ne.getCastlingColor(e)===D.white?t.board.getPiece(n)===I.WhiteRook:t.board.getPiece(n)===I.BlackRook},o=function(t){return ne.getCastlingKingCoordinates(t).referentialEquals(e.from)},l=!0,c=!1,u=void 0;try{for(var s,h=this.castlings[Symbol.iterator]();!(l=(s=h.next()).done);l=!0){var f=s.value;a(f)&&i(f)&&!o(f)&&!r(f)&&n.push(f)}}catch(d){c=!0,u=d}finally{try{l||null==h.return||h.return()}finally{if(c)throw u}}return n}},{key:"getColorAfterMove",value:function(){return this.currentColor===D.white?D.black:D.white}},{key:"getEnPassantStateAfterMove",value:function(e){var t=this;return function(){var n=t.board.getPiece(e.from);return null!=n&&[I.WhitePawn,I.BlackPawn].includes(n)}()&&2===Math.abs(e.rankDelta)?function(){var t=2===e.from.rank?3:6;return new G(e.from.file,t)}():null}},{key:"getFullMoveNumberAfterMove",value:function(){return this.currentColor===D.black?this.fullMoveNumber+1:this.fullMoveNumber}},{key:"getHalfMoveClockAfterMove",value:function(e){return null!==this.board.getPiece(e.to)?0:this.halfMoveClock+1}},{key:"board",get:function(){return this._board=this._board||oe.fromFen(this._fen)}},{key:"castlings",get:function(){var e=this._fen.split(" ")[2];return"-"===e?[]:e.split("").map((function(e){return e}))}},{key:"currentColor",get:function(){switch(this._fen.split(" ")[1]){case"w":return D.white;case"b":return D.black;default:throw new V("Invalid player color")}}},{key:"enPassant",get:function(){var e=this._fen.split(" ")[3];return"-"===e?null:G.fromAlgebraicNotation(e)}},{key:"fen",get:function(){return this._fen}},{key:"fullMoveNumber",get:function(){return parseInt(this._fen.split(" ")[5])}},{key:"halfMoveClock",get:function(){return parseInt(this._fen.split(" ")[4],10)}}],[{key:"fromFen",value:function(e){return new t(e)}},{key:"fromParts",value:function(e,n,r,a,i,o){var l=n===D.white?"w":"b",c=0===r.length?"-":r.sort().join(""),u=a&&a.toAlgebraicNotationString()||"-";return t.fromFen("".concat(e.toFen()," ").concat(l," ").concat(c," ").concat(u," ").concat(i," ").concat(o))}}]),t}(q);!function(e){e.defaultInitial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",e.empty="8/8/8/8/8/8/8/8 - - 0 1"}(le||(le={}));var ke=le,ge=function e(){Object(W.a)(this,e)};ge.defaultInitial=ve.fromFen(ke.defaultInitial),ge.empty=ve.fromFen(ke.empty);var me=n(81),ye=(n(59),function(e){var t=e.piece,n=e.file,r=e.rank,i=e.isSelected,o=e.isLegalPieceMove,l=e.handleSquareSelected;return a.createElement("div",{className:"chessboard-square d-flex justify-content-center align-items-center "+function(){var e=[];return(U.indexOf(n)+x.indexOf(r))%2===1?e.push("light"):e.push("dark"),o&&e.push("legal-piece-move"),i&&e.push("selected"),e.join(" ")}(),onClick:function(){return l(new G(n,r))},"data-testid":"chessboard-square-".concat(n).concat(r)},a.createElement("span",null,t?t.unicodeSymbol:"\xa0"))}),be=(n(60),function(e){var t=e.chessboard,n=e.reverseBoard,r=e.selectedSquareCoordinates,i=e.pieceLegalMoveCoordinates,o=e.handleSquareSelected,l=n?Object(A.a)(x):Object(A.a)(x).reverse();return a.createElement(b.a,null,a.createElement(w.a,null,a.createElement("div",{className:"chessboard my-3","data-testid":"chessboard"},l.map((function(e){return a.createElement(b.a,{key:e},U.map((function(n){var l=new G(n,e);return a.createElement(ye,{key:"".concat(n).concat(e),piece:t.getPiece(new G(n,e)),file:n,rank:e,isSelected:l.referentialEquals(r),isLegalPieceMove:i.some((function(e){return e.referentialEquals(l)})),handleSquareSelected:o})})))})))))}),we=function(e){var t=e.currentPlayer,n=e.players,r=e.currentStatus,i=!ce.includes(r),o=n.some((function(e){return e instanceof fe})),l=t instanceof fe,c=l||i&&o;return a.createElement(M.a,{color:"warning",onClick:function(){c&&(i&&!l?n.find((function(e){return e instanceof fe})).requestUndo():t.requestUndo())},disabled:!c,"data-testid":"undo-move"},"Undo move")},pe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Object(W.a)(this,e),this._depth=void 0,this._stockfishWorker=void 0,this._depth=t,this._stockfishWorker=new Worker("".concat("/tychess","/stockfish-worker/stockfish.js"))}return Object(K.a)(e,[{key:"getMove",value:function(){var e=Object(B.a)(j.a.mark((function e(t){var n,r,a=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.currentColor,r=t.fen,e.abrupt("return",new Promise(function(){var e=Object(B.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a._stockfishWorker.postMessage("position fen ".concat(r));case 2:a._stockfishWorker.postMessage("go depth ".concat(a._depth)),a._stockfishWorker.onmessage=function(e){var r=e.data;if(Pe.hasFoundBestMove(r)){var i=a.getMoveFromMessage(n,r);null!==i&&t(i)}};case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMoveFromMessage",value:function(e,t){var n=/bestmove (\w\d\w\d)(\w?)/.exec(t);if(n){var r=n.length>=2&&n[2]?n[2]:null,a=null;if(null!==r){var i=e===D.white?r.toUpperCase():r;a=null===r?null:I.fromAlgebraicNotation(i)}var o=n[1][0],l=parseInt(n[1][1],10);if(!H(o)||!Q(l))throw new Error("Invalid from file/rank - file: ".concat(o," rank: ").concat(l,"."));var c=n[1][2],u=parseInt(n[1][3],10);if(!H(c)||!Q(u))throw new Error("Invalid to file/rank - file: ".concat(c," rank: ").concat(u,"."));return new L(new G(o,l),new G(c,u),a)}return null}}]),e}(),Pe=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,null,[{key:"hasFoundBestMove",value:function(e){return/bestmove/.test(e)}}]),e}(),Ce=(n(61),function(e){var t=e.color,n=e.pickedPieceCallback,r=[I.WhiteQueen,I.WhiteRook,I.WhiteBishop,I.WhiteKnight];return i.a.createElement(b.a,{className:"mt-3","data-testid":"promotion-piece-picker",id:"promotion-piece-picker"},i.a.createElement(w.a,null,"Promote to:"," ",i.a.createElement(me.a,null,r.map((function(e){var r=function(e,t){switch(e){case I.WhiteQueen:return t===D.white?I.WhiteQueen:I.BlackQueen;case I.WhiteRook:return t===D.white?I.WhiteRook:I.BlackRook;case I.WhiteBishop:return t===D.white?I.WhiteBishop:I.BlackBishop;case I.WhiteKnight:return t===D.white?I.WhiteKnight:I.BlackKnight;default:throw new Error("Invalid promotion piece")}}(e,t);return i.a.createElement(M.a,{key:r.unicodeSymbol,color:"success",outline:!0,onClick:function(){return n(r)}},i.a.createElement("span",{className:"promotion-piece"},r.unicodeSymbol))})),i.a.createElement(M.a,{outline:!0,onClick:function(){return n(null)}},"Cancel"))))}),Se=function(){function e(){Object(W.a)(this,e)}return Object(K.a)(e,null,[{key:"isEmptyFirstSelection",value:function(t,n){return null===t&&e.isSquareEmpty(n)}},{key:"isMoveToPromotion",value:function(e,t){return null!==t&&t===I.WhitePawn&&8===e.rank||t===I.BlackPawn&&1===e.rank}},{key:"isNonHumanPlayer",value:function(e){return!(e instanceof fe)}},{key:"isNonOwnPieceFirstSelection",value:function(e,t,n){return null!==e&&e.color!==t&&null===n}},{key:"isSquareEmpty",value:function(e){return null===e}}]),e}(),Oe=function(e,t){var n=Object(a.useState)(null),r=Object(c.a)(n,2),i=r[0],o=r[1],l=Object(a.useState)(null),u=Object(c.a)(l,2),s=u[0],h=u[1];return{handleSquareSelected:function(n){var r=e.board.getPiece(n);if(!(Se.isNonHumanPlayer(t)||Se.isEmptyFirstSelection(r,i)||Se.isNonOwnPieceFirstSelection(r,e.currentColor,i)))if(Se.isSquareEmpty(i))o(n);else if(i.referentialEquals(n))o(null);else{var a=e.board.getPiece(i);Se.isMoveToPromotion(n,a)?h((function(){return e=i,r=n,function(n){null!==n&&t.makeMove(new L(e,r,n)),o(null),h(null)};var e,r})):(t.makeMove(new L(i,n)),o(null))}},savedSquareCoordinates:i,pickPromotionCallback:s}},Me=function(e){var t=e.game,n=Object(a.useState)(t.getCurrentStatus()),r=Object(c.a)(n,2),i=r[0],o=r[1],l=Object(a.useState)(t.getCurrentState()),u=Object(c.a)(l,2),s=u[0],h=u[1],f=Object(a.useState)(t.getCurrentPlayer()),d=Object(c.a)(f,2),v=d[0],k=d[1];Object(a.useEffect)((function(){t.subscribeMoveProcessed((function(){h(t.getCurrentState()),o(t.getCurrentStatus()),k(t.getCurrentPlayer())}))}),[t]);var g=Oe(s,v,(function(e,n){return t.ruleEngine.isMoveValid(e,n)})),m=g.pickPromotionCallback,y=g.handleSquareSelected,p=g.savedSquareCoordinates,P=!(t.playerWhite instanceof fe)&&t.playerBlack instanceof fe,C=Object(a.useState)(P),S=Object(c.a)(C,2),O=S[0],E=S[1],j=t.playerWhite instanceof pe&&t.playerBlack instanceof pe?"it's a fish fight!":"shall we play?";return a.createElement(b.a,null,a.createElement(w.a,null,a.createElement(b.a,null,a.createElement(w.a,null,a.createElement("h1",null,j),a.createElement("h5",null,"status: ",i),a.createElement(me.a,null,a.createElement(we,{currentPlayer:t.getCurrentPlayer(),players:[t.playerWhite,t.playerBlack],currentStatus:t.getCurrentStatus()}),a.createElement(M.a,{onClick:function(){return E(!O)}},"Reverse board")))),a.createElement(b.a,null,a.createElement(w.a,null,m&&a.createElement(Ce,{color:s.currentColor,pickedPieceCallback:m}))),a.createElement(b.a,null,a.createElement(w.a,null,a.createElement(be,{chessboard:t.getCurrentState().board,reverseBoard:O,pieceLegalMoveCoordinates:function(e){var n=[];if(null===e)return n;var r=s.board.getPiece(e),a=function(e,t){return null!==t&&t===I.WhitePawn&&8===e.rank||t===I.BlackPawn&&1===e.rank},i=!0,o=!1,l=void 0;try{for(var c,u=oe.allCoordinates[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var h=c.value,f=s.currentColor===D.white?I.WhiteQueen:I.BlackQueen,d=a(h,r)?new L(e,h,f):new L(e,h);t.ruleEngine.isMoveValid(d,s)&&n.push(h)}}catch(v){o=!0,l=v}finally{try{i||null==u.return||u.return()}finally{if(o)throw l}}return n}(p),selectedSquareCoordinates:p,handleSquareSelected:y}))),a.createElement(b.a,null,a.createElement(w.a,null,"Current turn: ",t.getCurrentState().currentColor)),a.createElement(b.a,null,a.createElement(w.a,null,"FEN: ",t.getCurrentState().fen))))},Ee=n(40),je=function(e){var t=e.setChessGame,n={name:"Stockfish",create:function(e){return new pe(e)}},r=[{name:"Human",create:function(e){return new fe}},n];return i.a.createElement(i.a.Fragment,null,i.a.createElement("h1",null,"Create a new game"),i.a.createElement(Ee.a,{initialValues:{selectedPlayerWhite:r[0].name,selectedPlayerBlack:r[1].name,playerWhiteAnalysisDepth:1,playerBlackAnalysisDepth:1},onSubmit:function(e){var n=r.find((function(t){return t.name===e.selectedPlayerWhite})).create(e.playerWhiteAnalysisDepth),a=r.find((function(t){return t.name===e.selectedPlayerBlack})).create(e.playerBlackAnalysisDepth);t(new de(ge.defaultInitial,n,a))}},(function(e){var t,a,o,l,c=e.values,u=e.handleChange,s=e.handleSubmit;return i.a.createElement(p.a,null,(t=c.selectedPlayerWhite,a=c.selectedPlayerBlack,o=c.playerWhiteAnalysisDepth,l=c.playerBlackAnalysisDepth,(t===n.name&&o>=15||a===n.name&&l>=15)&&i.a.createElement(P.a,{color:"dark"},"If you find it's taking too much time to process a move, consider lowering the analysis depth.")),i.a.createElement(C.a,null,i.a.createElement(S.a,{for:"player-white"},"White"),i.a.createElement(O.a,{id:"player-white",type:"select",name:"selectedPlayerWhite",onChange:u,defaultValue:c.selectedPlayerWhite,"data-testid":"player-white-selector"},r.map((function(e){return i.a.createElement("option",{key:e.name},e.name)})))),c.selectedPlayerWhite===n.name&&i.a.createElement(C.a,null,i.a.createElement(S.a,{for:"playerWhiteAnalysisDepth"},"Engine analysis depth"),i.a.createElement(O.a,{type:"number",name:"playerWhiteAnalysisDepth",value:c.playerWhiteAnalysisDepth,onChange:u})),i.a.createElement(C.a,null,i.a.createElement(S.a,{for:"player-black"},"Black"),i.a.createElement(O.a,{id:"player-black",type:"select",name:"selectedPlayerBlack",onChange:u,defaultValue:c.selectedPlayerBlack,"data-testid":"player-black-selector"},r.map((function(e){return i.a.createElement("option",{key:e.name},e.name)})))),c.selectedPlayerBlack===n.name&&i.a.createElement(C.a,null,i.a.createElement(S.a,{for:"playerBlackAnalysisDepth"},"Engine analysis depth"),i.a.createElement(O.a,{type:"number",name:"playerBlackAnalysisDepth",value:c.playerBlackAnalysisDepth,onChange:u})),i.a.createElement(M.a,{type:"submit",color:"primary","data-testid":"submit",onClick:s},"Go"))})))},Be=function(){var e=Object(a.useState)(null),t=Object(c.a)(e,2),n=t[0],r=t[1];return i.a.createElement(b.a,null,i.a.createElement(w.a,null,null==n?i.a.createElement(je,{setChessGame:r}):i.a.createElement(Me,{game:n})))},Ae=function(){return i.a.createElement(y,null,i.a.createElement(Be,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(Ae,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[42,1,2]]]);
//# sourceMappingURL=main.0aee667a.chunk.js.map